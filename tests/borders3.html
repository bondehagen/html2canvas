<html>
<head>
    <title>border tests</title>
    <style type="text/css">
        #canvas {
            background: #ecf7fd;
        }

        .div {
            background: #ddddff;
            width: 400px;
            height: 400px;
            display: inline-block;
        }

        .div div {
            background: #000;
            margin: 40px;
            height: 300px;
            width: 300px;
            border: 6px solid;
            border-color: red yellow green blue;
            -moz-border-radius: 50px 50px;
            -webkit-border-radius: 50px 50px;
            border-radius: 50px 50px;
            border-top-left-radius: 10px 10px;
            border-top-right-radius: 80px 180px;
            border-bottom-left-radius: 50px 50px;
            border-bottom-right-radius: 20px 20px;
        }
    </style>
</head>
<body>

<canvas id="canvas" width="400" height="400"></canvas>
<div class="div">
    <div></div>
</div>

<script type="text/javascript">
    function clipRoundedRect(ctx, r, width, height, clipType, lineWidth) {
        if (clipType == 'stroke') {
            width += lineWidth * 2;
            height += lineWidth * 2;
        }
        var calcRadius = function(value) {
            switch (clipType) {
                case 'fill':
                    return Math.abs(value - lineWidth);
                case 'stroke':
                    return Math.abs(value + lineWidth / 2);
                default:
                    return Math.abs(value);
            }
        };
        r.top.left.a = calcRadius(r.top.left.a);
        r.top.left.b = calcRadius(r.top.left.b);
        r.top.right.a = calcRadius(r.top.right.a);
        r.top.right.b = calcRadius(r.top.right.b);
        r.bottom.left.a = calcRadius(r.bottom.left.a);
        r.bottom.left.b = calcRadius(r.bottom.left.b);
        r.bottom.right.a = calcRadius(r.bottom.right.a);
        r.bottom.right.b = calcRadius(r.bottom.right.b);

        var topWidth = width - r.top.right.a;
        var rightHeight = height - r.bottom.right.b;
        var bottomWidth = width - r.bottom.right.a;
        var leftHeight = height - r.bottom.left.b;

        ctx.beginPath();
        ctx.moveTo(r.top.left.a / 4, r.top.left.b / 4);
        ctx.quadraticCurveTo(r.top.left.a / 2, 0, r.top.left.a, 0);
        ctx.lineTo(topWidth, 0);
        ctx.quadraticCurveTo(topWidth + r.top.right.a / 2, 0, topWidth + r.top.right.a - r.top.right.a / 4, r.top.right.b / 4);
        ctx.quadraticCurveTo(topWidth + r.top.right.a, r.top.right.b / 2, topWidth + r.top.right.a, r.top.right.b);
        ctx.lineTo(bottomWidth + r.bottom.right.a, rightHeight);
        ctx.quadraticCurveTo(bottomWidth + r.bottom.right.a, rightHeight + (r.bottom.right.b / 2), bottomWidth + r.bottom.right.a - r.bottom.right.a / 4, rightHeight + (r.bottom.right.b - r.bottom.right.b / 4));
        ctx.quadraticCurveTo(bottomWidth + r.bottom.right.a / 2, rightHeight + r.bottom.right.b, bottomWidth, rightHeight + r.bottom.right.b);
        ctx.lineTo(r.bottom.left.a, leftHeight + r.bottom.left.b);
        ctx.quadraticCurveTo(r.bottom.left.a / 2, leftHeight + r.bottom.left.b, r.bottom.left.a / 4, leftHeight + r.bottom.left.b - r.bottom.left.b / 4);
        ctx.quadraticCurveTo(0, leftHeight + r.bottom.left.b / 2, 0, leftHeight);
        ctx.lineTo(0, r.top.left.b);
        ctx.quadraticCurveTo(0, r.top.left.b / 2, r.top.left.a / 4, r.top.left.b / 4);
        ctx.closePath();
        ctx.clip();
    }

    function strokeCorners(ctx, radius, width, height, lineWidth) {
        var topWidth = width - radius.top.right.a + lineWidth;
        var rightHeight = height - radius.bottom.right.b + lineWidth;
        var bottomWidth = width - radius.bottom.right.a + lineWidth;
        var leftHeight = height - radius.bottom.left.b + lineWidth;
        // top
        ctx.strokeStyle = "red";
        ctx.beginPath();
        ctx.moveTo(radius.top.left.a / 4, radius.top.left.b / 4);
        ctx.quadraticCurveTo(radius.top.left.a / 2, 0, radius.top.left.a, 0);
        ctx.moveTo(topWidth, 0);
        ctx.quadraticCurveTo(topWidth + radius.top.right.a / 2, 0, topWidth + radius.top.right.a - radius.top.right.a / 4, radius.top.right.b / 4);
        ctx.stroke();

        // right
        ctx.strokeStyle = "yellow";
        ctx.beginPath();
        ctx.moveTo(topWidth + radius.top.right.a - radius.top.right.a / 4, radius.top.right.b / 4);
        ctx.quadraticCurveTo(topWidth + radius.top.right.a, radius.top.right.b / 2, topWidth + radius.top.right.a, radius.top.right.b);
        ctx.moveTo(bottomWidth + radius.bottom.right.a, rightHeight);
        ctx.quadraticCurveTo(bottomWidth + radius.bottom.right.a, rightHeight + (radius.bottom.right.b / 2), bottomWidth + radius.bottom.right.a - radius.bottom.right.a / 4, rightHeight + (radius.bottom.right.b - radius.bottom.right.b / 4));
        ctx.stroke();

        // bottom
        ctx.strokeStyle = "green";
        ctx.beginPath();
        ctx.moveTo(bottomWidth + radius.bottom.right.a - radius.bottom.right.a / 4, rightHeight + (radius.bottom.right.b - radius.bottom.right.b / 4));
        ctx.quadraticCurveTo(bottomWidth + radius.bottom.right.a / 2, rightHeight + radius.bottom.right.b, bottomWidth, rightHeight + radius.bottom.right.b);
        ctx.moveTo(radius.bottom.left.a, leftHeight + radius.bottom.left.b);
        ctx.quadraticCurveTo(radius.bottom.left.a / 2, leftHeight + radius.bottom.left.b, radius.bottom.left.a / 4, leftHeight + radius.bottom.left.b - radius.bottom.left.b / 4);
        ctx.stroke();

        // left
        ctx.strokeStyle = "blue";
        ctx.beginPath();
        ctx.moveTo(radius.bottom.left.a / 4, leftHeight + radius.bottom.left.b - radius.bottom.left.b / 4);
        ctx.quadraticCurveTo(0, leftHeight + radius.bottom.left.b / 2, 0, leftHeight);
        ctx.moveTo(0, radius.top.left.b);
        ctx.quadraticCurveTo(0, radius.top.left.b / 2, radius.top.left.a / 4, radius.top.left.b / 4);
        ctx.stroke();
    }

    (function() {
        var margin = 40;
        var width = 300; // box width + pading
        var height = 300;
        var lineWidth = 6;
        var Radius = function() {
            return {top:{
                left:{
                    a:10, // horizontal
                    b:10 // vertical
                },
                right:{
                    a:80,
                    b:180
                }
            },
                bottom:{
                    left:{
                        a:50,
                        b:50
                    },
                    right:{
                        a:20,
                        b:20
                    }
                }}
        };

        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');

        ctx.lineWidth = lineWidth;
        ctx.lineJoin = 'round';
        ctx.strokeStyle = "red";
        ctx.fillStyle = "blue";

        // Clip background
        ctx.save();
        ctx.translate(margin + lineWidth, margin + lineWidth);
        clipRoundedRect(ctx, new Radius(), width, height, 'fill', lineWidth);

        // Draw background
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, width, height);
        ctx.restore();

        ctx.save();
        ctx.translate(margin, margin);

        clipRoundedRect(ctx, new Radius(), width, height, 'stroke', lineWidth);

        ctx.translate(lineWidth / 2, lineWidth / 2);
        ctx.strokeRect(0, 0, width + lineWidth, height + lineWidth);

        strokeCorners(ctx, new Radius(), width, height, lineWidth);
        ctx.restore();
    })();
</script>
</body>

</html>